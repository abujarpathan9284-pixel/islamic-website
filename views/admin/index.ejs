<%-include("navbar")%>

<style>
    /* Analytics Dashboard Styles - Enhanced */
    .analytics-dashboard {
        padding: 20px 0;
        min-height: 100vh;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
    }

    .dashboard-header {
        margin-bottom: 30px;
        text-align: center;
        position: relative;
    }

    .dashboard-header h1 {
        color: var(--green-color);
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(90deg, var(--green-color), var(--gold-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .dashboard-header p {
        color: #666;
        font-size: 1.1rem;
        max-width: 600px;
        margin: 0 auto 20px;
    }

    /* Dashboard Actions */
    .dashboard-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    /* Enhanced Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border-left: 5px solid var(--green-color);
        position: relative;
        overflow: hidden;
        height: 100%;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }

    .stat-card.gold {
        border-left-color: var(--gold-color);
    }

    .stat-card.blue {
        border-left-color: #3498db;
    }

    .stat-card.purple {
        border-left-color: #9b59b6;
    }

    .stat-card.orange {
        border-left-color: #e67e22;
    }

    .stat-card.red {
        border-left-color: #e74c3c;
    }

    .stat-card.teal {
        border-left-color: #1abc9c;
    }

    .stat-icon {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 2.5rem;
        opacity: 0.15;
        color: inherit;
        transition: all 0.3s ease;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.1);
        opacity: 0.25;
    }

    .stat-number {
        font-size: 2.8rem;
        font-weight: 700;
        color: #2c3e50;
        line-height: 1;
        margin-bottom: 5px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .stat-label {
        font-size: 1rem;
        color: #7f8c8d;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .stat-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }

    .stat-change {
        font-size: 0.9rem;
        padding: 3px 10px;
        border-radius: 20px;
        background: #e8f5e8;
        color: #27ae60;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .stat-change.negative {
        background: #ffeaea;
        color: #e74c3c;
    }

    .stat-change i {
        font-size: 0.8rem;
    }

    .stat-trend {
        font-size: 0.85rem;
        color: #7f8c8d;
    }

    /* Progress Bars in Stats */
    .stat-progress {
        margin-top: 10px;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 0.9rem;
        color: #666;
    }

    .progress-bar {
        height: 6px;
        background: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: var(--green-color);
        border-radius: 3px;
        transition: width 0.5s ease;
    }

    .stat-card.gold .progress-fill {
        background: var(--gold-color);
    }

    .stat-card.blue .progress-fill {
        background: #3498db;
    }

    /* Enhanced Charts Section */
    .charts-section {
        margin-bottom: 40px;
    }

    .chart-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        height: 100%;
        transition: all 0.3s ease;
    }

    .chart-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

    .chart-header h3 {
        color: #2c3e50;
        font-size: 1.4rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chart-header h3 i {
        color: var(--green-color);
    }

    .chart-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .chart-period {
        display: flex;
        gap: 5px;
        background: #f8f9fa;
        padding: 3px;
        border-radius: 8px;
    }

    .period-btn {
        padding: 6px 15px;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: #666;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        white-space: nowrap;
    }

    .period-btn.active {
        background: white;
        color: var(--green-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .period-btn:hover:not(.active) {
        color: var(--green-color);
        background: rgba(67, 97, 238, 0.05);
    }

    /* Enhanced Charts */
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }

    /* Enhanced Lists */
    .list-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        height: 100%;
        transition: all 0.3s ease;
    }

    .list-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }

    .list-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

    .list-header h3 {
        color: #2c3e50;
        font-size: 1.4rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .list-header h3 i {
        color: var(--green-color);
    }

    .view-all {
        color: var(--green-color);
        text-decoration: none;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
    }

    .view-all:hover {
        color: var(--gold-color);
        gap: 8px;
    }

    .list-container {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 5px;
    }

    .list-container::-webkit-scrollbar {
        width: 6px;
    }

    .list-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .list-container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
    }

    .list-container::-webkit-scrollbar-thumb:hover {
        background: #a1a1a1;
    }

    .list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #f5f5f5;
        transition: all 0.3s ease;
        border-radius: 8px;
    }

    .list-item:hover {
        background: linear-gradient(90deg, rgba(46, 204, 113, 0.05), transparent);
        transform: translateX(5px);
        border-bottom-color: #e0e0e0;
    }

    .list-item:last-child {
        border-bottom: none;
    }

    .item-content {
        flex: 1;
        min-width: 0;
    }

    .item-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .item-subtitle {
        font-size: 0.85rem;
        color: #7f8c8d;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .item-tag {
        background: #f8f9fa;
        color: #666;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
    }

    .item-tag.story {
        background: #e8f5e8;
        color: var(--green-color);
    }

    .item-tag.hadith {
        background: #f0e8f5;
        color: #9b59b6;
    }

    .item-tag.quran {
        background: #e8f0f5;
        color: #3498db;
    }

    .item-stats {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .item-stat {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #7f8c8d;
        font-size: 0.9rem;
        white-space: nowrap;
    }

    .item-stat i {
        font-size: 1rem;
    }

    .item-stat.reads {
        color: #3498db;
    }

    .item-stat.likes {
        color: #e74c3c;
    }

    .item-stat.time {
        color: #9b59b6;
    }

    .item-stat.comments {
        color: #f39c12;
    }

    .item-stat.shares {
        color: #1abc9c;
    }

    .rank {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        background: #f8f9fa;
        border-radius: 50%;
        font-weight: 700;
        color: #2c3e50;
        font-size: 0.9rem;
        margin-right: 15px;
        flex-shrink: 0;
        transition: all 0.3s ease;
    }

    .rank-1 {
        background: linear-gradient(135deg, var(--gold-color), #ffb347);
        color: white;
        box-shadow: 0 3px 10px rgba(241, 196, 15, 0.3);
    }

    .rank-2 {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
        box-shadow: 0 3px 10px rgba(149, 165, 166, 0.3);
    }

    .rank-3 {
        background: linear-gradient(135deg, #cd7f32, #b06e2c);
        color: white;
        box-shadow: 0 3px 10px rgba(205, 127, 50, 0.3);
    }

    .rank-4 {
        background: #f8f9fa;
        color: #666;
    }

    .rank-5 {
        background: #f8f9fa;
        color: #666;
    }

    /* Time Distribution Grid */
    .time-distribution {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .time-slot {
        background: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid #eee;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    .time-slot:hover {
        transform: translateY(-5px);
        border-color: var(--green-color);
        box-shadow: 0 5px 20px rgba(46, 204, 113, 0.15);
    }

    .time-icon {
        font-size: 1.5rem;
        color: var(--green-color);
        margin-bottom: 10px;
    }

    .time-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
        font-size: 1rem;
    }

    .time-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--green-color);
        margin-bottom: 5px;
    }

    .time-percentage {
        font-size: 0.9rem;
        color: #7f8c8d;
        padding: 3px 10px;
        background: #f8f9fa;
        border-radius: 20px;
        display: inline-block;
    }

    /* Performance Metrics */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .metric-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .metric-title {
        font-size: 1.2rem;
        color: #2c3e50;
        margin: 0;
    }

    .metric-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--green-color);
        margin-bottom: 10px;
    }

    .metric-description {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-bottom: 20px;
    }

    .metric-progress {
        height: 10px;
        background: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .metric-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--green-color), var(--gold-color));
        border-radius: 5px;
        transition: width 0.5s ease;
    }

    /* Quick Actions */
    .quick-actions {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px 15px;
        background: #f8f9fa;
        border: 2px solid #eee;
        border-radius: 10px;
        color: #666;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: var(--green-color);
        color: white;
        border-color: var(--green-color);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .action-btn i {
        font-size: 1.8rem;
        margin-bottom: 10px;
    }

    .action-btn span {
        font-size: 0.9rem;
        font-weight: 600;
        text-align: center;
    }

    /* Summary Cards */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .summary-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        border-top: 4px solid var(--green-color);
    }

    .summary-card .stat-number {
        font-size: 2.2rem;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .dashboard-header h1 {
            font-size: 2rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .chart-container {
            height: 250px;
        }

        .list-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .item-stats {
            width: 100%;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .time-distribution {
            grid-template-columns: repeat(2, 1fr);
        }

        .metrics-grid {
            grid-template-columns: 1fr;
        }

        .actions-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 576px) {
        .dashboard-header h1 {
            font-size: 1.8rem;
        }

        .chart-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }

        .chart-actions {
            width: 100%;
            justify-content: space-between;
        }

        .chart-period {
            width: 100%;
        }

        .period-btn {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            font-size: 0.8rem;
        }

        .time-distribution {
            grid-template-columns: 1fr;
        }

        .actions-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Loading Animation */
    .loading-skeleton {
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% { opacity: 0.6; }
        50% { opacity: 1; }
        100% { opacity: 0.6; }
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: #7f8c8d;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 20px;
        color: #bdc3c7;
    }

    .empty-state h4 {
        margin-bottom: 10px;
        color: #95a5a6;
    }

    /* Enhanced Buttons */
    .action-button {
        background: linear-gradient(135deg, var(--green-color), #27ae60);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(46, 204, 113, 0.2);
    }

    .action-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
        background: linear-gradient(135deg, #27ae60, var(--green-color));
    }

    .action-button.secondary {
        background: white;
        color: var(--green-color);
        border: 2px solid var(--green-color);
        box-shadow: none;
    }

    .action-button.secondary:hover {
        background: var(--green-color);
        color: white;
    }

    /* Refresh Button */
    .refresh-btn {
        background: white;
        border: 2px solid var(--green-color);
        color: var(--green-color);
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        background: var(--green-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
    }

    .refresh-btn.loading i {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Notification Badges */
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #e74c3c;
        color: white;
        font-size: 0.7rem;
        padding: 3px 8px;
        border-radius: 10px;
        min-width: 20px;
        text-align: center;
    }

    /* Filter Section */
    .filter-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .filter-row {
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        min-width: 200px;
    }

    .filter-label {
        font-size: 0.9rem;
        color: #666;
        font-weight: 600;
    }

    .filter-select {
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: white;
        color: #333;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .filter-select:focus {
        outline: none;
        border-color: var(--green-color);
        box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
    }

    /* Tooltips */
    .info-tooltip {
        position: relative;
        display: inline-flex;
        align-items: center;
        margin-left: 5px;
    }

    .info-tooltip .tooltip-text {
        visibility: hidden;
        width: 200px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.85rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .info-tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
    }

    .info-tooltip i {
        color: #3498db;
        cursor: help;
    }
</style>

<!-- Dashboard Header -->
<div class="analytics-dashboard">
    <div class="container">
        <div class="dashboard-header">
            <h1><i class="fas fa-chart-line"></i> Analytics Dashboard</h1>
            <!-- <p>Comprehensive insights into your Islamic content performance and user engagement</p> -->
            
            <div class="dashboard-actions">
                <button class="action-button" id="refreshAnalytics">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="action-button secondary" id="exportData">
                    <i class="fas fa-download"></i> Export Data
                </button>
                <button class="action-button secondary" id="generateReport">
                    <i class="fas fa-file-pdf"></i> Generate Report
                </button>
            </div>
        </div>

        Quick Filters
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">Time Period</label>
                    <select class="filter-select" id="timePeriod">
                        <option value="today">Today</option>
                        <option value="week" selected>Last 7 Days</option>
                        <option value="month">Last 30 Days</option>
                        <option value="quarter">Last 90 Days</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Content Type</label>
                    <select class="filter-select" id="contentType">
                        <option value="all">All Content</option>
                        <option value="stories">Stories</option>
                        <option value="hadith">Hadith</option>
                        <option value="quran">Quran</option>
                        <option value="duas">Duas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">User Type</label>
                    <select class="filter-select" id="userType">
                        <option value="all">All Users</option>
                        <option value="new">New Users</option>
                        <option value="returning">Returning Users</option>
                        <option value="registered">Registered Users</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Device Type</label>
                    <select class="filter-select" id="deviceType">
                        <option value="all">All Devices</option>
                        <option value="mobile">Mobile</option>
                        <option value="desktop">Desktop</option>
                        <option value="tablet">Tablet</option>
                    </select>
                </div>
                <button class="action-button" id="applyFilters">
                    <i class="fas fa-filter"></i> Apply Filters
                </button>
            </div>
        </div>

        <!-- Summary Cards -->
        <!-- <div class="summary-grid">
            <div class="summary-card">
                <div class="stat-label">
                    <i class="fas fa-calendar-day"></i> Today's Activity
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Real-time activity data for the current day</span>
                    </span>
                </div>
                <div class="stat-number" id="todayActivity">1,247</div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 12.5%</span>
                    <span class="stat-trend">vs yesterday</span>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="stat-label">
                    <i class="fas fa-clock"></i> Avg. Session Duration
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Average time users spend on the platform per session</span>
                    </span>
                </div>
                <div class="stat-number" id="avgSessionTime">4m 32s</div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 8.3%</span>
                    <span class="stat-trend">vs last week</span>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="stat-label">
                    <i class="fas fa-users"></i> Active Users Now
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Number of users currently active on the platform</span>
                    </span>
                </div>
                <div class="stat-number" id="activeUsers">87</div>
                <div class="stat-details">
                    <span class="stat-change positive"><i class="fas fa-arrow-up"></i> 5.7%</span>
                    <span class="stat-trend">vs 1 hour ago</span>
                </div>
            </div>
        </div> -->

        <!-- Main Stats Grid -->
        <!-- <div class="stats-grid">
            <div class="stat-card blue">
                <i class="fas fa-users stat-icon"></i>
                <div class="stat-number" id="totalUsers">12,847</div>
                <div class="stat-label">
                    <i class="fas fa-user-plus"></i> Total Users
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Total registered users on the platform</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 245 new</span>
                    <span class="stat-trend">this week</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Growth Target</span>
                        <span>75%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card gold">
                <i class="fas fa-eye stat-icon"></i>
                <div class="stat-number" id="totalViews">245,820</div>
                <div class="stat-label">
                    <i class="fas fa-chart-bar"></i> Total Page Views
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Total number of pages viewed by all users</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 15.2%</span>
                    <span class="stat-trend">vs last month</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Engagement Rate</span>
                        <span>68%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 68%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card purple">
                <i class="fas fa-heart stat-icon"></i>
                <div class="stat-number" id="totalLikes">18,524</div>
                <div class="stat-label">
                    <i class="fas fa-thumbs-up"></i> Total Likes
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Total likes received on all content</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 22.8%</span>
                    <span class="stat-trend">vs last month</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Like Rate</span>
                        <span>7.5%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card teal">
                <i class="fas fa-comments stat-icon"></i>
                <div class="stat-number" id="totalComments">3,847</div>
                <div class="stat-label">
                    <i class="fas fa-comment-dots"></i> Total Comments
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Total comments on all content</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 18.3%</span>
                    <span class="stat-trend">vs last month</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Comment Rate</span>
                        <span>1.6%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 32%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card orange">
                <i class="fas fa-share-alt stat-icon"></i>
                <div class="stat-number" id="totalShares">5,621</div>
                <div class="stat-label">
                    <i class="fas fa-retweet"></i> Total Shares
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Total number of times content was shared</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 31.5%</span>
                    <span class="stat-trend">vs last month</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Viral Potential</span>
                        <span>42%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 42%"></div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card red">
                <i class="fas fa-book-open stat-icon"></i>
                <div class="stat-number" id="completedReads">8,924</div>
                <div class="stat-label">
                    <i class="fas fa-book-reader"></i> Completed Reads
                    <span class="info-tooltip">
                        <i class="fas fa-info-circle"></i>
                        <span class="tooltip-text">Number of stories/hadith read to completion</span>
                    </span>
                </div>
                <div class="stat-details">
                    <span class="stat-change negative"><i class="fas fa-arrow-down"></i> 2.1%</span>
                    <span class="stat-trend">vs last month</span>
                </div>
                <div class="stat-progress">
                    <div class="progress-label">
                        <span>Completion Rate</span>
                        <span>36%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 36%"></div>
                    </div>
                </div>
            </div>
        </div> -->

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            <div class="actions-grid">
                <a href="#" class="action-btn">
                    <i class="fas fa-chart-pie"></i>
                    <span>View Reports</span>
                </a>
                <a href="#" class="action-btn">
                    <i class="fas fa-user-edit"></i>
                    <span>Manage Users</span>
                </a>
                <a href="#" class="action-btn">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="action-btn">
                    <i class="fas fa-bell"></i>
                    <span>Notifications <span class="notification-badge">3</span></span>
                </a>
                <a href="#" class="action-btn">
                    <i class="fas fa-question-circle"></i>
                    <span>Help Center</span>
                </a>
                <a href="#" class="action-btn">
                    <i class="fas fa-download"></i>
                    <span>Export Data</span>
                </a>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="row">
                <div class="col-lg-8">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Traffic Overview</h3>
                            <div class="chart-actions">
                                <div class="chart-period">
                                    <button class="period-btn active" data-period="7d">7D</button>
                                    <button class="period-btn" data-period="30d">30D</button>
                                    <button class="period-btn" data-period="90d">90D</button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-pie-chart"></i> Traffic Sources</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="sourcesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <h4 class="metric-title">User Engagement</h4>
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 12%</span>
                </div>
                <div class="metric-value">78%</div>
                <div class="metric-description">
                    Percentage of active users who interact with content
                </div>
                <div class="metric-progress">
                    <div class="metric-progress-bar" style="width: 78%"></div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <h4 class="metric-title">Content Quality</h4>
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 8%</span>
                </div>
                <div class="metric-value">92%</div>
                <div class="metric-description">
                    User satisfaction rating based on feedback
                </div>
                <div class="metric-progress">
                    <div class="metric-progress-bar" style="width: 92%"></div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <h4 class="metric-title">Platform Performance</h4>
                    <span class="stat-change"><i class="fas fa-arrow-up"></i> 5%</span>
                </div>
                <div class="metric-value">98.5%</div>
                <div class="metric-description">
                    Uptime and response time reliability
                </div>
                <div class="metric-progress">
                    <div class="metric-progress-bar" style="width: 98.5%"></div>
                </div>
            </div>
        </div>

        <!-- Lists Section -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="list-card">
                    <div class="list-header">
                        <h3><i class="fas fa-fire"></i> Most Read Stories</h3>
                        <a href="#" class="view-all">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div class="list-container" id="mostReadStories">
                        <!-- Content will be loaded by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="list-card">
                    <div class="list-header">
                        <h3><i class="fas fa-heart"></i> Most Liked Hadith</h3>
                        <a href="#" class="view-all">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div class="list-container" id="mostLikedHadith">
                        <!-- Content will be loaded by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Distribution -->
        <div class="chart-card">
            <div class="chart-header">
                <h3><i class="fas fa-clock"></i> Time Distribution</h3>
                <div class="chart-actions">
                    <div class="chart-period">
                        <button class="period-btn active" data-view="hours">Hours</button>
                        <button class="period-btn" data-view="days">Days</button>
                        <button class="period-btn" data-view="weeks">Weeks</button>
                    </div>
                </div>
            </div>
            <div class="time-distribution" id="timeDistribution">
                <!-- Content will be loaded by JavaScript -->
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="chart-card mt-4">
            <div class="chart-header">
                <h3><i class="fas fa-history"></i> Recent Activity</h3>
                <a href="#" class="view-all">
                    View All <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="list-container" id="recentActivity">
                <!-- Content will be loaded by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Enhanced Analytics Dashboard JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize charts
        let trafficChart = null;
        let sourcesChart = null;
        let activityChart = null;
        
        // Dashboard data
        let dashboardData = {
            // Summary stats
            todayActivity: 1247,
            avgSessionTime: 4.5,
            activeUsers: 87,
            
            // Main stats
            totalUsers: 12847,
            totalViews: 245820,
            totalLikes: 18524,
            totalComments: 3847,
            totalShares: 5621,
            completedReads: 8924,
            
            // Engagement metrics
            engagementRate: 78,
            contentQuality: 92,
            platformPerformance: 98.5,
            
            // Traffic data
            trafficData: {
                '7d': [850, 920, 1100, 1050, 1200, 1150, 1247],
                '30d': Array.from({length: 30}, (_, i) => 800 + Math.floor(Math.random() * 500)),
                '90d': Array.from({length: 90}, (_, i) => 600 + Math.floor(Math.random() * 700))
            },
            
            // Sources data
            sources: [
                { label: 'Direct', value: 45, color: '#2ecc71' },
                { label: 'Search', value: 30, color: '#3498db' },
                { label: 'Social', value: 15, color: '#9b59b6' },
                { label: 'Referral', value: 10, color: '#e74c3c' }
            ],
            
            // Content data
            mostReadStories: [
                { id: 1, title: 'The Story of Prophet Yusuf (AS)', reads: 2450, likes: 320, comments: 45, type: 'story', rank: 1 },
                { id: 2, title: 'The Patience of Prophet Ayyub (AS)', reads: 1980, likes: 290, comments: 38, type: 'story', rank: 2 },
                { id: 3, title: 'Ibrahim (AS) and the Idols', reads: 1750, likes: 250, comments: 32, type: 'story', rank: 3 },
                { id: 4, title: 'Musa (AS) and Pharaoh', reads: 1620, likes: 210, comments: 28, type: 'story', rank: 4 },
                { id: 5, title: "Bilal's (RA) Unwavering Faith", reads: 1480, likes: 195, comments: 25, type: 'story', rank: 5 }
            ],
            
            mostLikedHadith: [
                { id: 1, text: 'The strong believer is better and more beloved to Allah...', likes: 520, shares: 120, comments: 65, type: 'hadith', rank: 1 },
                { id: 2, text: 'None of you truly believes until he loves for his brother...', likes: 480, shares: 98, comments: 58, type: 'hadith', rank: 2 },
                { id: 3, text: 'The best among you are those who have the best manners...', likes: 420, shares: 85, comments: 52, type: 'hadith', rank: 3 },
                { id: 4, text: 'Kindness is a mark of faith, and whoever is not kind...', likes: 380, shares: 75, comments: 48, type: 'hadith', rank: 4 },
                { id: 5, text: 'The world is a prison for the believer and paradise...', likes: 350, shares: 68, comments: 42, type: 'hadith', rank: 5 }
            ],
            
            // Time distribution
            timeDistribution: [
                { time: 'Morning (6-10 AM)', visitors: 850, percentage: 22, icon: 'fas fa-sun' },
                { time: 'Midday (10 AM-2 PM)', visitors: 1200, percentage: 31, icon: 'fas fa-clock' },
                { time: 'Afternoon (2-6 PM)', visitors: 1050, percentage: 27, icon: 'fas fa-coffee' },
                { time: 'Evening (6-10 PM)', visitors: 750, percentage: 19, icon: 'fas fa-moon' },
                { time: 'Night (10 PM-6 AM)', visitors: 320, percentage: 8, icon: 'fas fa-bed' }
            ],
            
            // Recent activity
            recentActivity: [
                { user: 'Ahmed Ali', action: 'completed reading', content: 'Story of Prophet Yusuf', time: '2 min ago', icon: 'fas fa-book' },
                { user: 'Fatima Khan', action: 'liked', content: 'Hadith about kindness', time: '5 min ago', icon: 'fas fa-heart' },
                { user: 'Omar Hassan', action: 'commented on', content: 'Quran Tafseer', time: '12 min ago', icon: 'fas fa-comment' },
                { user: 'Aisha Malik', action: 'shared', content: 'Islamic Story', time: '25 min ago', icon: 'fas fa-share' },
                { user: 'Yusuf Ibrahim', action: 'registered', content: 'New Account', time: '1 hour ago', icon: 'fas fa-user-plus' },
                { user: 'Zainab Omar', action: 'completed quiz', content: 'Islamic Quiz', time: '2 hours ago', icon: 'fas fa-graduation-cap' },
                { user: 'Bilal Ahmed', action: 'bookmarked', content: 'Daily Dua', time: '3 hours ago', icon: 'fas fa-bookmark' }
            ]
        };

        // Initialize dashboard
        initDashboard();

        // Event Listeners
        document.getElementById('refreshAnalytics').addEventListener('click', refreshData);
        document.getElementById('exportData').addEventListener('click', exportData);
        document.getElementById('generateReport').addEventListener('click', generateReport);
        document.getElementById('applyFilters').addEventListener('click', applyFilters);

        // Period buttons
        document.querySelectorAll('.period-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const container = this.closest('.chart-period');
                container.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                if (this.closest('.chart-card').querySelector('#trafficChart')) {
                    updateTrafficChart(this.dataset.period);
                } else if (this.closest('.chart-card').querySelector('#timeDistribution')) {
                    updateTimeDistribution(this.dataset.view);
                }
            });
        });

        // Functions
        function initDashboard() {
            // Update all stats
            updateSummaryStats();
            updateMainStats();
            updateMetrics();
            
            // Initialize charts
            initTrafficChart();
            initSourcesChart();
            
            // Load lists
            loadMostReadStories();
            loadMostLikedHadith();
            loadTimeDistribution('hours');
            loadRecentActivity();
            
            // Start real-time updates
            startRealTimeUpdates();
        }

        function updateSummaryStats() {
            // Format and update summary stats
            document.getElementById('todayActivity').textContent = 
                dashboardData.todayActivity.toLocaleString();
            
            document.getElementById('avgSessionTime').textContent = 
                `${Math.floor(dashboardData.avgSessionTime)}m ${Math.floor((dashboardData.avgSessionTime % 1) * 60)}s`;
            
            document.getElementById('activeUsers').textContent = 
                dashboardData.activeUsers.toLocaleString();
        }

        function updateMainStats() {
            const stats = [
                { id: 'totalUsers', value: dashboardData.totalUsers },
                { id: 'totalViews', value: dashboardData.totalViews },
                { id: 'totalLikes', value: dashboardData.totalLikes },
                { id: 'totalComments', value: dashboardData.totalComments },
                { id: 'totalShares', value: dashboardData.totalShares },
                { id: 'completedReads', value: dashboardData.completedReads }
            ];
            
            stats.forEach(stat => {
                const element = document.getElementById(stat.id);
                if (element) {
                    animateCounter(element, parseInt(element.textContent.replace(/,/g, '')) || 0, stat.value);
                }
            });
        }

        function updateMetrics() {
            // Update engagement metrics
            document.querySelectorAll('.metric-value')[0].textContent = `${dashboardData.engagementRate}%`;
            document.querySelectorAll('.metric-value')[1].textContent = `${dashboardData.contentQuality}%`;
            document.querySelectorAll('.metric-value')[2].textContent = `${dashboardData.platformPerformance}%`;
        }

        function initTrafficChart() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            // Generate labels for 7 days
            const labels = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' }));
            }

            trafficChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Visitors',
                        data: dashboardData.trafficData['7d'],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#2ecc71',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#2ecc71',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `Visitors: ${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                },
                                color: '#666'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666'
                            }
                        }
                    }
                }
            });
        }

        function updateTrafficChart(period) {
            let data, labels;
            
            switch(period) {
                case '30d':
                    data = dashboardData.trafficData['30d'];
                    labels = Array.from({length: 30}, (_, i) => (i + 1));
                    break;
                case '90d':
                    data = dashboardData.trafficData['90d'];
                    labels = Array.from({length: 90}, (_, i) => (i + 1));
                    break;
                default: // 7d
                    data = dashboardData.trafficData['7d'];
                    const dateLabels = [];
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date();
                        date.setDate(date.getDate() - i);
                        dateLabels.push(date.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' }));
                    }
                    labels = dateLabels;
            }
            
            trafficChart.data.labels = labels;
            trafficChart.data.datasets[0].data = data;
            trafficChart.update();
        }

        function initSourcesChart() {
            const ctx = document.getElementById('sourcesChart').getContext('2d');
            
            sourcesChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dashboardData.sources.map(s => s.label),
                    datasets: [{
                        data: dashboardData.sources.map(s => s.value),
                        backgroundColor: dashboardData.sources.map(s => s.color),
                        borderWidth: 2,
                        borderColor: '#fff',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function loadMostReadStories() {
            const container = document.getElementById('mostReadStories');
            
            if (dashboardData.mostReadStories.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><h4>No stories found</h4></div>';
                return;
            }
            
            let html = '';
            dashboardData.mostReadStories.forEach(story => {
                html += `
                    <div class="list-item">
                        <div class="rank rank-${story.rank}">${story.rank}</div>
                        <div class="item-content">
                            <div class="item-title">${story.title}</div>
                            <div class="item-subtitle">
                                <span class="item-tag ${story.type}">${story.type}</span>
                                <span>${story.comments} comments</span>
                            </div>
                        </div>
                        <div class="item-stats">
                            <div class="item-stat reads">
                                <i class="fas fa-eye"></i>
                                <span>${story.reads.toLocaleString()}</span>
                            </div>
                            <div class="item-stat likes">
                                <i class="fas fa-heart"></i>
                                <span>${story.likes.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadMostLikedHadith() {
            const container = document.getElementById('mostLikedHadith');
            
            if (dashboardData.mostLikedHadith.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><h4>No hadith found</h4></div>';
                return;
            }
            
            let html = '';
            dashboardData.mostLikedHadith.forEach(hadith => {
                html += `
                    <div class="list-item">
                        <div class="rank rank-${hadith.rank}">${hadith.rank}</div>
                        <div class="item-content">
                            <div class="item-title">${hadith.text}</div>
                            <div class="item-subtitle">
                                <span class="item-tag ${hadith.type}">${hadith.type}</span>
                                <span>${hadith.comments} comments</span>
                            </div>
                        </div>
                        <div class="item-stats">
                            <div class="item-stat likes">
                                <i class="fas fa-heart"></i>
                                <span>${hadith.likes.toLocaleString()}</span>
                            </div>
                            <div class="item-stat shares">
                                <i class="fas fa-share"></i>
                                <span>${hadith.shares.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadTimeDistribution(view = 'hours') {
            const container = document.getElementById('timeDistribution');
            
            let html = '';
            dashboardData.timeDistribution.forEach(slot => {
                html += `
                    <div class="time-slot">
                        <div class="time-icon">
                            <i class="${slot.icon}"></i>
                        </div>
                        <div class="time-label">${slot.time}</div>
                        <div class="time-value">${slot.visitors.toLocaleString()}</div>
                        <div class="time-percentage">${slot.percentage}% of daily traffic</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateTimeDistribution(view) {
            // In a real app, this would fetch new data based on the view
            loadTimeDistribution(view);
        }

        function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            if (dashboardData.recentActivity.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-history"></i><h4>No recent activity</h4></div>';
                return;
            }
            
            let html = '';
            dashboardData.recentActivity.forEach(activity => {
                html += `
                    <div class="list-item">
                        <div class="item-content">
                            <div class="item-title">
                                <i class="${activity.icon} me-2"></i>
                                <strong>${activity.user}</strong> ${activity.action} "${activity.content}"
                            </div>
                            <div class="item-subtitle">
                                <span>${activity.time}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function refreshData() {
            const btn = document.getElementById('refreshAnalytics');
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            // Show loading state
            btn.classList.add('loading');
            icon.classList.add('fa-spin');
            text.textContent = 'Refreshing...';
            
            // Simulate API call
            setTimeout(() => {
                // Update data with realistic changes
                const changes = {
                    todayActivity: Math.max(0, dashboardData.todayActivity + Math.floor(Math.random() * 100) - 30),
                    activeUsers: Math.max(0, dashboardData.activeUsers + Math.floor(Math.random() * 20) - 5),
                    totalViews: Math.max(0, dashboardData.totalViews + Math.floor(Math.random() * 500)),
                    totalLikes: Math.max(0, dashboardData.totalLikes + Math.floor(Math.random() * 100)),
                    totalComments: Math.max(0, dashboardData.totalComments + Math.floor(Math.random() * 50)),
                    totalShares: Math.max(0, dashboardData.totalShares + Math.floor(Math.random() * 30)),
                    avgSessionTime: Math.max(1, (dashboardData.avgSessionTime + (Math.random() * 0.5 - 0.2)).toFixed(1))
                };
                
                // Apply changes
                Object.assign(dashboardData, changes);
                
                // Update dashboard
                updateSummaryStats();
                updateMainStats();
                
                // Update traffic chart if viewing current period
                const activePeriod = document.querySelector('.chart-period .period-btn.active').dataset.period;
                if (activePeriod === '7d') {
                    const newTraffic = [...dashboardData.trafficData['7d']];
                    newTraffic[newTraffic.length - 1] = dashboardData.todayActivity;
                    dashboardData.trafficData['7d'] = newTraffic;
                    trafficChart.data.datasets[0].data = newTraffic;
                    trafficChart.update();
                }
                
                // Reset button
                btn.classList.remove('loading');
                icon.classList.remove('fa-spin');
                text.textContent = 'Refresh Data';
                
                // Show success message
                showNotification('Analytics data refreshed successfully!', 'success');
            }, 1500);
        }

        function exportData() {
            // Convert data to CSV format
            const csvContent = convertToCSV();
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `islamic-analytics-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully!', 'success');
        }

        function generateReport() {
            const btn = document.getElementById('generateReport');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                showNotification('PDF report generated successfully!', 'success');
                
                // In a real app, this would trigger a download
                // For now, we'll just show a notification
            }, 2000);
        }

        function applyFilters() {
            const timePeriod = document.getElementById('timePeriod').value;
            const contentType = document.getElementById('contentType').value;
            const userType = document.getElementById('userType').value;
            const deviceType = document.getElementById('deviceType').value;
            
            // Show loading
            const btn = document.getElementById('applyFilters');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Applying...';
            
            // Simulate filter application
            setTimeout(() => {
                btn.innerHTML = originalText;
                showNotification(`Filters applied: ${timePeriod}, ${contentType}, ${userType}, ${deviceType}`, 'info');
                
                // In a real app, this would fetch new data based on filters
                // For now, we'll just update some stats to show the effect
                updateFilteredStats();
            }, 1000);
        }

        function updateFilteredStats() {
            // Simulate filtered data updates
            const filterMultiplier = 0.8 + Math.random() * 0.4; // Random between 0.8 and 1.2
            
            // Update main stats with filtered values
            const filteredStats = {
                totalViews: Math.floor(dashboardData.totalViews * filterMultiplier),
                totalLikes: Math.floor(dashboardData.totalLikes * filterMultiplier),
                totalComments: Math.floor(dashboardData.totalComments * filterMultiplier),
                todayActivity: Math.floor(dashboardData.todayActivity * filterMultiplier)
            };
            
            // Animate the changes
            Object.keys(filteredStats).forEach(stat => {
                const element = document.getElementById(stat);
                if (element) {
                    const current = parseInt(element.textContent.replace(/,/g, ''));
                    animateCounter(element, current, filteredStats[stat], 500);
                }
            });
        }

        function convertToCSV() {
            let csv = 'Metric,Value,Change\n';
            csv += `Today's Activity,${dashboardData.todayActivity},+12.5%\n`;
            csv += `Total Users,${dashboardData.totalUsers},+8.3%\n`;
            csv += `Total Views,${dashboardData.totalViews},+15.2%\n`;
            csv += `Total Likes,${dashboardData.totalLikes},+22.8%\n`;
            csv += `Total Comments,${dashboardData.totalComments},+18.3%\n`;
            csv += `Total Shares,${dashboardData.totalShares},+31.5%\n`;
            csv += `Completed Reads,${dashboardData.completedReads},-2.1%\n\n`;
            
            csv += 'Most Read Stories,Reads,Likes,Comments\n';
            dashboardData.mostReadStories.forEach(story => {
                csv += `${story.title},${story.reads},${story.likes},${story.comments}\n`;
            });
            
            csv += '\nMost Liked Hadith,Likes,Shares,Comments\n';
            dashboardData.mostLikedHadith.forEach(hadith => {
                csv += `${hadith.text},${hadith.likes},${hadith.shares},${hadith.comments}\n`;
            });
            
            csv += '\nTime Distribution,Visitors,Percentage\n';
            dashboardData.timeDistribution.forEach(time => {
                csv += `${time.time},${time.visitors},${time.percentage}%\n`;
            });
            
            return csv;
        }

        function startRealTimeUpdates() {
            // Update active users every 10 seconds
            setInterval(() => {
                // Simulate active user changes
                const change = Math.floor(Math.random() * 10) - 3;
                dashboardData.activeUsers = Math.max(0, dashboardData.activeUsers + change);
                
                // Update display
                document.getElementById('activeUsers').textContent = 
                    dashboardData.activeUsers.toLocaleString();
                
                // Update today's activity
                if (change > 0) {
                    dashboardData.todayActivity += Math.floor(Math.random() * 5);
                    document.getElementById('todayActivity').textContent = 
                        dashboardData.todayActivity.toLocaleString();
                }
                
                // Update chart if viewing current day
                const activePeriod = document.querySelector('.chart-period .period-btn.active').dataset.period;
                if (activePeriod === '7d') {
                    const data = trafficChart.data.datasets[0].data;
                    data[data.length - 1] = dashboardData.todayActivity;
                    trafficChart.update();
                }
            }, 10000);
        }

        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();
            
            // Create notification
            const notification = document.createElement('div');
            notification.className = `notification-toast notification-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas ${icons[type] || icons.info}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#2ecc71' : 
                           type === 'error' ? '#e74c3c' : 
                           type === 'warning' ? '#f39c12' : '#3498db'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.15);
                z-index: 9999;
                animation: slideInRight 0.3s ease;
                display: flex;
                align-items: center;
                gap: 12px;
                max-width: 400px;
                font-weight: 500;
            `;
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
            
            // Add animation styles if not already added
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Counter animation function
        function animateCounter(element, start, end, duration = 1000) {
            if (start === end) return;
            
            const increment = end > start ? 1 : -1;
            const steps = Math.abs(end - start);
            const stepTime = Math.max(1, Math.floor(duration / steps));
            
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current.toLocaleString();
                
                if (current === end) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // Initialize counters with animation
        setTimeout(() => {
            // Animate summary stats
            animateCounter(document.getElementById('todayActivity'), 0, dashboardData.todayActivity);
            animateCounter(document.getElementById('activeUsers'), 0, dashboardData.activeUsers);
            
            // Animate main stats with staggered delays
            const stats = [
                { id: 'totalUsers', value: dashboardData.totalUsers, delay: 100 },
                { id: 'totalViews', value: dashboardData.totalViews, delay: 200 },
                { id: 'totalLikes', value: dashboardData.totalLikes, delay: 300 },
                { id: 'totalComments', value: dashboardData.totalComments, delay: 400 },
                { id: 'totalShares', value: dashboardData.totalShares, delay: 500 },
                { id: 'completedReads', value: dashboardData.completedReads, delay: 600 }
            ];
            
            stats.forEach(stat => {
                setTimeout(() => {
                    const element = document.getElementById(stat.id);
                    if (element) {
                        animateCounter(element, 0, stat.value);
                    }
                }, stat.delay);
            });
        }, 500);
    });
</script>

<%-include("footer")%>